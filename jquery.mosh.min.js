/*jQuery Mosh Plugin - Copyright (c) 2012 Allen Evans - Released under MIT License. See http://mosh.allenevans.co.uk/ for full details.*/ 
(function(b){var a=function(c){this.context=c?c.selector:null;this.options=null;this.xhrJson=null;this.xhrXml=null;this.xhrXsl=null};a.prototype={init:function(c){this.options={json:null,xml:null,xsl:null,data:null,error:null,success:null,xslCharEscape:false};b.extend(this.options,c);return this.merge()},destroy:function(){this.context=null;this.data=null;this.options=null;this.xhrJson=null;this.xhrXml=null;this.xhrXsl=null},merge:function(i){var c=this,o=c.options;if(!i&&(!c.xhrXml||!c.xhrXsl)){c.getData(function(){c.merge.call(c,true)})}else{if(c.xhrXml&&c.xhrXsl){var h=c.context?c.context:document.body,d,g,e;h=b(h);if((h&&h.tagName&&h.tagName.toUpperCase()=="IFRAME")){h=h.contentWindow.document.body}if(window.ActiveXObject){try{if(o.dataXsl||(c.xhrXml&&c.xhrXml.responseXML&&(typeof c.xhrXml.responseXML.transformNode=="undefined"||typeof c.xhrXml.responseXML.hasOwnProperty=="undefined"))){var m=new ActiveXObject("MSXML2.FreeThreadedDomDocument");m.validateOnParse=false;m.loadXML(c.xhrXsl.responseText);var n=new ActiveXObject("MSXML2.XSLTemplate");n.stylesheet=m.documentElement;var f=n.createProcessor();f.input=c.xhrXml.responseXML;for(e in o.dataXsl){if(typeof o.dataXsl[e]!="function"){f.addParameter(e,c.options.dataXsl[e])}}f.transform();g=f.output.toString()}else{if(c.xhrXml.responseXML){g=c.xhrXml.responseXML.transformNode(c.xhrXsl.responseXML)}}if(o.xslCharEscape&&g){g=g.replace(/&amp;/g,"&");g=g.replace(/&gt;/g,">");g=g.replace(/&lt;/g,"<")}h.empty();h.html(g)}catch(l){b.error("Transform: "+(l?(l.message?l.message:l.toString()):"")+" Xml: "+o.xml+" Xsl: "+o.xsl);if(typeof o.error=="function"){o.error.apply(c.$,[l,c.xhrXml,c.xhrXsl])}}}else{try{d=new XSLTProcessor();d.importStylesheet(c.xhrXsl.responseXML||b.mosh.stringToXml(c.xhrXsl.responseText));if(o.dataXsl){for(e in o.dataXsl){if(typeof o.dataXsl[e]!="function"){d.setParameter("",e,o.dataXsl[e])}}}h.empty();h.append(d.transformToFragment(c.xhrXml.responseXML,document));if(c.options.xslCharEscape){g=h.html();if(g){g=g.replace(/&amp;/g,"&");g=g.replace(/&amp;/g,"&");g=g.replace(/&gt;/g,">");g=g.replace(/&lt;/g,"<");h.html(g)}}}catch(j){b.error("Transform: "+(j?(j.message?j.message:j.toString()):"")+" Xml: "+o.xml+" Xsl: ");if(typeof o.error=="function"){o.error.apply(c.$,[j,c.xhrXml,c.xhrXsl])}}}if(typeof o.success=="function"){o.success.apply(c.$,[c.xhrXml,c.xhrXsl])}}}},getData:function(i){var c=this,k=c.options;if(!(k.xml||k.json)){b.error("Xml / JSON has not been defined.")}else{if(!k.xsl){b.error("Xsl has not been defined.")}else{if(!c.dataXml&&!c.dataJson){var g=k.xml,e=k.xsl,j=k.json;if(j){if(typeof j=="string"){b.ajax(j,{data:k.data,dataType:"json",cache:false,success:function(l,n,m){c.xhrJson=m;c.dataJson=l;c.dataXml=b.mosh.objectToXml(l);c.xhrXml={responseText:b.mosh.xmlToString(c.dataXml),responseXML:c.dataXml};if(typeof i=="function"){i.call(c,true)}},error:function(m,n,l){b.error(n+" Json: "+j)}})}else{if(k.json&&k.json.url){var f=k.json.success;k.json.success=function(l,n,m){c.xhrJson=m;c.dataJson=l;c.dataXml=b.mosh.objectToXml(l);c.xhrXml={responseText:b.mosh.xmlToString(c.dataXml),responseXML:c.dataXml};if(typeof i=="function"){i.call(c,true)}if(typeof f=="function"){f(l,n,m)}};k.json.dataType=k.json.dataType||"json";b.ajax(k.json)}}}else{if(g&&(typeof g=="string"||c.isXmlDoc(g))){if(c.isXmlDoc(g)){c.xhrXml={responseText:b.mosh.xmlToString(g),responseXML:g};if(typeof i=="function"){i.call(c,true)}}else{if(typeof g=="string"&&g.match(/^</)){c.dataXml=b.mosh.stringToXml(g);c.xhrXml={responseText:g,responseXML:c.dataXml};if(typeof i=="function"){i.call(c,true)}}else{b.ajax(g,{cache:false,data:k.data,success:function(l,n,m){c.xhrXml=m;c.dataXml=l;if(typeof i=="function"){i.call(c,true)}},error:function(m,n,l){b.error(n+" Xml: "+g)}})}}}else{if(k.xml&&k.xml.url){var h=k.xml.success;k.xml.success=function(l,n,m){c.xhrXml=m;c.dataXml=l;if(typeof i=="function"){i.call(c,true)}if(typeof h=="function"){h(l,n,m)}};b.ajax(k.xml)}}}}if(e&&(typeof e=="string"||c.isXmlDoc(e))){if(c.isXmlDoc(e)){c.xhrXsl={responseText:b.mosh.xmlToString(e),responseXML:e};if(typeof i=="function"){i.call(c,true)}}else{if(e.match(/^</)){c.dataXsl=b.mosh.stringToXml(e);c.xhrXsl={responseText:e,responseXML:c.dataXsl};if(typeof i=="function"){i.call(c,true)}}else{b.ajax(e,{cache:false,success:function(l,n,m){c.xhrXsl=m;c.dataXsl=l;if(typeof i=="function"){i.call(c,true)}},error:function(m,n,l){b.error(n+" Xsl: "+e)}})}}}else{if(k.xsl&&k.xsl.url){var d=k.xsl.success;k.xsl.success=function(l,n,m){c.xhrXsl=m;c.dataXsl=l;if(typeof i=="function"){i.call(c,true)}if(typeof d=="function"){d(l,n,m)}};b.ajax(k.xsl)}}}}return this},isXmlDoc:function(c){return typeof c=="object"&&(c.xmlVersion||c.xml||c.loadXML||(c.contentType=="text/xml"&&c.nodeName=="#document"))}};b.mosh=b.fn.mosh=function(d){var c=new a(this);if(c[d]){return c[d].apply(c,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return c.init.apply(c,arguments)}else{b.error("Unknown method "+d);return this}}};b.extend(b.fn.mosh,{xmlToObject:function(p){var h=null,k={},o,e,g,m,c,f,n,l,d;if(p){o=p.childNodes;d=o.length;for(var j=0;j<d;j++){e=o[j];g=e.tagName;if(typeof g!="undefined"){m=e.firstChild;if(m){n=m.nextSibling;l=m.nodeValue;if(m.nodeName=="#text"){f=((l&&l.length)?l.length:0)?l:null;while(n&&n.nodeName=="#text"){m=n;n=m.nextSibling;l=m.nodeValue;f+=((l&&l.length)?l.length:0)?l:null}}else{f=null}c=k[g];if((!(typeof f=="undefined"||f===null||(typeof f=="string"&&f==="")||(typeof f=="object"&&f.constructor==Array&&!f.length)))&&typeof f=="string"&&!n){if(typeof c!="undefined"){if(!(typeof c=="object"&&c.constructor==Array)){k[g]=[c];c=k[g]}if(!isNaN(f)){f=Number(f)}c[c.length]=f}else{if(!isNaN(f)){f=Number(f)}k[g]=f}}else{if(c){if(!(typeof c=="object"&&c.constructor==Array)){k[g]=[c];c=k[g]}c[c.length]=b.mosh.xmlToObject(e)}else{k[g]=b.mosh.xmlToObject(e)}}}else{k[g]=null}}}h=k}if(h&&h.object&&b.mosh.propCount(h)==1){h=h.object}return h},objectToXml:function(f,l,c,j,d){var k,h="",e,i;if(f){l=l?l:"";c=c?c:"";j=j||typeof f=="function";d=d||5;if(!l){if(f.constructor==Array){l="array"}else{if(typeof f=="string"){l="string"}else{if(typeof f=="boolean"){l="boolean"}else{if(typeof f=="number"){l="number"}else{if(typeof f=="function"){l="function"}else{if(b.mosh.propCount(f)>1){l="object"}}}}}}}if(document.implementation&&document.implementation.createDocument){k=document.implementation.createDocument(c,l,null)}else{k=new ActiveXObject("MSXML2.DOMDocument");e=l;if(l){i=l.indexOf(":")}if(i>=0){h=l.substring(0,i);e=l.substring(i+1)}k.loadXML("<"+(h?h+":":"")+e+(c?" xmlns:"+h+'="'+c+'"':"")+"/>")}if(k){var g=function(t,w,p,m,s){var y,v,n,o,r;if(typeof p!="undefined"){if(s>0||typeof p=="string"||typeof p=="number"||typeof p=="function"){if(typeof p=="string"||typeof p=="number"||typeof p=="function"){w.appendChild(t.createTextNode((p.toString?p.toString():p)))}else{try{for(y in p){if(typeof p[y]!="function"||j){v=p[y];if(!isNaN(y)){if(p.constructor==Array){r="item"}else{r="_"+y}}else{if(y.match(/\$/)){r=y.replace(/\$/g,"_")}else{r=y}}o=t.createElementNS?t.createElementNS(m,r):t.createNode(1,r,m);if(typeof v!="undefined"){if(typeof v=="object"){if(v&&v.constructor==Array){n=v.length;for(var q=0;q<n;q++){o=t.createElementNS?t.createElementNS(m,r):t.createNode(1,r,m);g(t,o,v[q],m,s-1);w.appendChild(o)}}else{g(t,o,v,m,s-1);w.appendChild(o)}}else{o.appendChild(t.createTextNode((v.toString?v.toString():v)));w.appendChild(o)}}}}}catch(u){}}}else{if(s===0&&p!==null){w.appendChild(t.createTextNode("{object}"))}}}};g(k,k.firstChild||k,f,c,d)}}return k},stringToXml:function(c){var d=null;if(c){if(typeof DOMParser!="undefined"){var e=new DOMParser();d=e.parseFromString(c,"text/xml")}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(c)}}return d},xmlToString:function(d){var e=null;if(d){if(d.xml){e=d.xml}else{var c=new XMLSerializer();e=c.serializeToString(d)}}return e},propCount:function(d,e){var f=0;if(typeof d!="string"){for(var c in d){if(e||typeof d[c]!="function"){f++}}}return f}})})(jQuery);